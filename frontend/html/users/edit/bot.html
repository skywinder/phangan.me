{% extends "layout.html" %}
{% load static %}

{% block title %}
    –ë–æ—Ç ‚Äî {{ block.super }}
{% endblock %}

{% block content %}
    <div class="content user-edit">
        <div class="form-title">ü§ñ<br>–¢–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç</div>

        <div class="block">
            <div class="block-description">
                <p>
                    <strong>–ë–æ—Ç ‚Äî –≤–∞–∂–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –ö–ª—É–±—É.</strong>
                    –û–Ω –æ–ø–æ–≤–µ—â–∞–µ—Ç –æ –Ω–æ–≤—ã—Ö –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è—Ö, —á–µ—Ä–µ–∑ –Ω–µ–≥–æ –º–æ–∂–Ω–æ –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –Ω–∏—Ö –∏ –¥–∞–∂–µ –ø–∏—Å–∞—Ç—å –ø–æ—Å—Ç—ã, —Ñ–æ—Ä–≤–∞—Ä–¥—è –µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—è.
                </p>

                <p>
                    –ù–∞ –Ω–µ–≥–æ –∑–∞–≤—è–∑–∞–Ω–æ –º–Ω–æ–≥–æ –ø–æ–ª–µ–∑–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ –∏ –º—ã –æ—á–µ–Ω—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º –µ–≥–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å.
                </p>

                <p id="telegram-auth-data" style="font-weight: bold;">
                    {% if user.telegram_id %}
                       –°–µ–π—á–∞—Å –ø—Ä–∏–≤—è–∑–∞–Ω –∞–∫–∫–∞—É–Ω—Ç: {{ user.telegram_data.username }} ‚úÖ
                    {% endif %}
                </p>

                <p>
                    <script src="https://telegram.org/js/telegram-widget.js?8" data-telegram-login="phangan_club_bot" data-size="large" data-onauth="onTelegramAuth(user)" data-request-access="write"></script>
                    <script type="text/javascript">
                        function onTelegramAuth(user) {
                            fetch('{% url "link_telegram" %}?is_ajax=true', {
                                method: 'POST',
                                headers: {
                                    'Accept': 'application/json, text/plain, */*',
                                    'Content-Type': 'application/json'
                                },
                                credentials: "include",
                                body: JSON.stringify(user)
                            })
                            .then((response) => {
                                return response.json();
                            })
                            .then((data) => {
                              if (data.status === "success") {
                                  document.getElementById("telegram-auth-data").innerHTML = "üòé –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã –∫–∞–∫: " + data.telegram.username;
                                  document.getElementById("telegram-auth-button").style.display = "none";
                              } else {
                                  document.getElementById("telegram-auth-data").innerHTML = "–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.";
                              }
                              document.getElementById("telegram-auth-data").style.display = "block";
                            });
                        }
                    </script>
                </p>

                <p>
                    ‚òùÔ∏è –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ —Å–≤–µ—Ä—Ö—É –Ω–µ –≤–∏–¥–Ω–æ, –∑–Ω–∞—á–∏—Ç –∫–∞–∫–æ–π-—Ç–æ AdBlock –µ—ë –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª, –ø—Ä–∏–¥—ë—Ç—Å—è –µ–≥–æ –æ–±–º–∞–Ω—É—Ç—å.
                    –ó–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞—à–µ–≥–æ <a href="{{ settings.TELEGRAM_BOT_URL }}" rel="noreferrer" target="_blank">–±–æ—Ç–∞</a>, –ø–æ—Å–ª–µ —á–µ–≥–æ –Ω–∞–ø–∏—à–∏—Ç–µ –µ–º—É –∫–æ–º–∞–Ω–¥—É –∏ –≤–∞—à —Å–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–æ–¥ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª:
                </p>
                <div style="font-size: 120%; color: #333333">
                  <strong><code>/auth {{ user.secret_hash }}</code></strong>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
